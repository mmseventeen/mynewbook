
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Geometric optics &#8212; Computational Physics PH3080</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script >const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Content with notebooks" href="notebooks.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Computational Physics PH3080</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="content.html">
   Content in Jupyter Book
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="markdown.html">
     Markdown Files
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="notebooks.html">
     Content with notebooks
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Geometric optics
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/mmseventeen/mynewbook/main?urlpath=tree/08Geometric_optics.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://teachinghub.st-andrews.ac.uk/thub/hub/user-redirect/git-pull?repo=https://github.com/mmseventeen/mynewbook&urlpath=tree/mynewbook/08Geometric_optics.ipynb&branch=main"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on JupyterHub"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_jupyterhub.svg">
  </span>
<span class="headerbtn__text-container">JupyterHub</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/mmseventeen/mynewbook"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/08Geometric_optics.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#physics-background">
   Physics background
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#programming-techniques">
   Programming techniques
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#linear-algebra">
     Linear algebra
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-additional-abcd-matrices">
     Define additional ABCD matrices
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#verification-through-a-simple-system">
     Verification through a simple system
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#draw-the-optics">
     Draw the optics
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-another-lens">
     Add another lens
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compare-with-combined-matrix">
     Compare with combined matrix
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#predefined-functions">
     Predefined functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-bundle-of-parallel-rays">
     Create a bundle of parallel rays
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#propagate-rays-through-telescope">
     Propagate rays through telescope
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#draw-propagation-through-telescope">
     Draw propagation through telescope
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#verify-combined-abcd-matrix">
     Verify combined ABCD matrix
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#imaging-systems">
     Imaging systems
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-imaging-in-telescope">
     Plot imaging in telescope
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#study">
   Study
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-imaging-of-an-eye">
     Model imaging of an eye
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#quantifying-focus">
     Quantifying focus
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-best-focus">
     Find best focus
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#combined-abcd-matrix-of-imaging-systems">
     Combined ABCD matrix of imaging systems
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#magnification-factor">
     Magnification factor
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#f-system-lateral-magnification">
     4F system lateral magnification
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#periodic-optical-system">
     Periodic optical system
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#abcd-eigenvalue">
     ABCD eigenvalue
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stability-region-plot">
     Stability region plot
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#laser-cavity-stability">
     Laser cavity stability
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#advanced-problem">
   Advanced problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#function-glossary">
   Function glossary
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Geometric optics</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#physics-background">
   Physics background
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#programming-techniques">
   Programming techniques
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#linear-algebra">
     Linear algebra
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-additional-abcd-matrices">
     Define additional ABCD matrices
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#verification-through-a-simple-system">
     Verification through a simple system
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#draw-the-optics">
     Draw the optics
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-another-lens">
     Add another lens
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compare-with-combined-matrix">
     Compare with combined matrix
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#predefined-functions">
     Predefined functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-bundle-of-parallel-rays">
     Create a bundle of parallel rays
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#propagate-rays-through-telescope">
     Propagate rays through telescope
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#draw-propagation-through-telescope">
     Draw propagation through telescope
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#verify-combined-abcd-matrix">
     Verify combined ABCD matrix
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#imaging-systems">
     Imaging systems
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-imaging-in-telescope">
     Plot imaging in telescope
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#study">
   Study
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-imaging-of-an-eye">
     Model imaging of an eye
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#quantifying-focus">
     Quantifying focus
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-best-focus">
     Find best focus
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#combined-abcd-matrix-of-imaging-systems">
     Combined ABCD matrix of imaging systems
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#magnification-factor">
     Magnification factor
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#f-system-lateral-magnification">
     4F system lateral magnification
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#periodic-optical-system">
     Periodic optical system
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#abcd-eigenvalue">
     ABCD eigenvalue
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stability-region-plot">
     Stability region plot
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#laser-cavity-stability">
     Laser cavity stability
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#advanced-problem">
   Advanced problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#function-glossary">
   Function glossary
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="section" id="geometric-optics">
<h1>Geometric optics<a class="headerlink" href="#geometric-optics" title="Permalink to this headline">¶</a></h1>
<pre>
PH3080 (Computational Physics)
Michael Mazilu and Aly Gillies, University of St Andrews
ph3080@st-andrews.ac.uk 
Version: 2021; (CC BY-NC 2.0) 
</pre><div class="cell tag_imports docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
<span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">eig</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="physics-background">
<h2>Physics background<a class="headerlink" href="#physics-background" title="Permalink to this headline">¶</a></h2>
<img src="../../ph3080/img/osys.png" width =750/>
<p>In this study we will model the propagation of rays through simple optical systems consisting of lenses and curved mirrors.
To do this, we use the small angle approximation, i.e. the rays propagate in a <em>paraxial regime</em> (close to the optic-axis), where the following relationship is valid:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{pmatrix}x_2\\ x'_2\end{pmatrix}=\begin{pmatrix}A&amp;B\\C&amp;D\end{pmatrix} \begin{pmatrix}x_1\\ x'_1\end{pmatrix} \label{abcd}\end{split}\]</div>
<p>In this, <span class="math notranslate nohighlight">\(x_1\)</span> and <span class="math notranslate nohighlight">\(x'_1\)</span> are the height and gradient of the incident ray with respect to the optic-axis at position <span class="math notranslate nohighlight">\(z_1\)</span>. Similarly, <span class="math notranslate nohighlight">\(x_2\)</span> and <span class="math notranslate nohighlight">\(x'_2\)</span> are the height and gradient of the transmitted ray at position <span class="math notranslate nohighlight">\(z_2\)</span>.  The matrix elements <span class="math notranslate nohighlight">\(A\)</span>, <span class="math notranslate nohighlight">\(B\)</span>, <span class="math notranslate nohighlight">\(C\)</span> and <span class="math notranslate nohighlight">\(D\)</span>  describe an optical system consisting of one or more optical components.
In optics, these matrices are called <strong>ABCD</strong> matrices.
Of particular interest to us are the following fundamental optical components:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Free-space distance <span class="math notranslate nohighlight">\(d\)</span></p></th>
<th class="head"><p>Thin lens</p></th>
<th class="head"><p>Curved mirror</p></th>
<th class="head"><p>Object/Imaging plane</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>$<span class="math notranslate nohighlight">\(\begin{pmatrix}1&amp;d\\0&amp;1\end{pmatrix}\)</span>$</p></td>
<td><p>$<span class="math notranslate nohighlight">\(\begin{pmatrix}1&amp;0\\\displaystyle -\frac{1}{f}&amp;1\end{pmatrix}\)</span>$</p></td>
<td><p>$<span class="math notranslate nohighlight">\(\begin{pmatrix}1&amp;0\\\displaystyle -\frac{2}{R_m}&amp;1\end{pmatrix}\)</span>$</p></td>
<td><p>$<span class="math notranslate nohighlight">\(\begin{pmatrix}1&amp;0\\0&amp;1\end{pmatrix}\)</span>$</p></td>
</tr>
</tbody>
</table>
<p>where <span class="math notranslate nohighlight">\(f\)</span> is the focal length of the thin lens, with <span class="math notranslate nohighlight">\(f&gt;0\)</span> for a convex lens,
and <span class="math notranslate nohighlight">\(R_m\)</span> is the radius of curvature of the mirror with <span class="math notranslate nohighlight">\(R_m&gt;0\)</span> for a concave mirror.</p>
<p>In our discussions we will call the vector  (<span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(x'\)</span>) the <em>ray-state</em> vector.</p>
<p>Propagation through multiple optical components allows for the modelling of microscopes, telescopes and laser cavities, and can be achieved via matrix multiplication.</p>
</div>
<div class="section" id="programming-techniques">
<h2>Programming techniques<a class="headerlink" href="#programming-techniques" title="Permalink to this headline">¶</a></h2>
<div class="section" id="linear-algebra">
<h3>Linear algebra<a class="headerlink" href="#linear-algebra" title="Permalink to this headline">¶</a></h3>
<p>Initially, we define a function that takes distance, <span class="math notranslate nohighlight">\(d\)</span>, as an argument and generates the ABCD matrix corresponding to a free-space propagation distance. In this case study, we will assume all distanced are in the same units, in this case  millimetres, unless otherwise stated.</p>
<div class="cell tag_example_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="n">ABCD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># start with the identity matrix then modify</span>
    <span class="n">ABCD</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span> <span class="n">d</span>          <span class="c1"># change value in first row, second column</span>
    <span class="k">return</span> <span class="n">ABCD</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dist</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[1. 5.]
 [0. 1.]]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="define-additional-abcd-matrices">
<h3>Define additional ABCD matrices<a class="headerlink" href="#define-additional-abcd-matrices" title="Permalink to this headline">¶</a></h3>
<p>Define functions for the other two fundamental optical components, naming them <code class="docutils literal notranslate"><span class="pre">lens</span></code> and <code class="docutils literal notranslate"><span class="pre">mirror</span></code>. Define a function called <code class="docutils literal notranslate"><span class="pre">plane</span></code> that returns the identity matrix for use as a placeholder for the object and imaging planes.</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">lens</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="n">ABCD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ABCD</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">f</span>
    <span class="k">return</span> <span class="n">ABCD</span>

<span class="k">def</span> <span class="nf">mirror</span><span class="p">(</span><span class="n">R</span><span class="p">):</span>
    <span class="n">ABCD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ABCD</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="n">R</span>
    <span class="k">return</span> <span class="n">ABCD</span>

<span class="k">def</span> <span class="nf">plane</span><span class="p">():</span>
    <span class="n">ABCD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ABCD</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lens:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">lens</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">mirror:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mirror</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">plane:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">plane</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>lens:
 [[ 1.   0. ]
 [-0.2  1. ]] 
mirror:
 [[ 1.   0. ]
 [-0.4  1. ]] 
plane:
 [[1. 0.]
 [0. 1.]]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="verification-through-a-simple-system">
<h3>Verification through a simple system<a class="headerlink" href="#verification-through-a-simple-system" title="Permalink to this headline">¶</a></h3>
<p>Consider a ray, defined by <span class="math notranslate nohighlight">\(z_1=0\)</span>, <span class="math notranslate nohighlight">\(x_1=40\)</span> and <span class="math notranslate nohighlight">\(x'_1=-0.2\)</span>, propagating through a lens positioned at <span class="math notranslate nohighlight">\(z=300\)</span> with focal length <span class="math notranslate nohighlight">\(f=180\)</span>.</p>
<p>Using the matrix multiplication method, verify that at position <span class="math notranslate nohighlight">\(z=450\)</span> the ray’s height and gradient are <span class="math notranslate nohighlight">\(-33.3333\)</span> and <span class="math notranslate nohighlight">\(-0.0888889\)</span> respectively. Remember that the ray has to go through free space up to the lens (<span class="math notranslate nohighlight">\(0\)</span> to <span class="math notranslate nohighlight">\(300\)</span>), then through the lens, then through free space to the requested position (<span class="math notranslate nohighlight">\(300\)</span> to <span class="math notranslate nohighlight">\(450\)</span>).</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ray0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">40</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">])</span> <span class="c1"># numpy natively treats a 1D array as a column vector, can also use np.array([[x], [x&#39;]])</span>
<span class="n">ray1</span> <span class="o">=</span> <span class="n">dist</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span><span class="nd">@ray0</span>
<span class="n">ray2</span> <span class="o">=</span> <span class="n">lens</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span><span class="nd">@ray1</span>
<span class="n">ray3</span> <span class="o">=</span> <span class="n">dist</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span><span class="nd">@ray2</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ray3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-33.33333333  -0.08888889]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="draw-the-optics">
<h3>Draw the optics<a class="headerlink" href="#draw-the-optics" title="Permalink to this headline">¶</a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot</span></code> to create a plot showing the lens, the optic-axis, and the ray before and after the lens, up to the point of observation. Use <code class="docutils literal notranslate"><span class="pre">plt.plot</span></code> and a dashed line for the lens (diameter 50), a solid line for the ray segments and an <code class="docutils literal notranslate"><span class="pre">axhline</span></code> for the optic-axis.</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Single lens system&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;z (mm)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;x (mm)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">450</span><span class="p">],</span> <span class="p">[</span><span class="n">ray0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ray1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ray3</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="c1"># plot the ray </span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">300</span><span class="p">,</span><span class="mi">300</span><span class="p">],[</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span><span class="mi">25</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>  <span class="c1"># plot the lens</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">)</span>                 <span class="c1"># plot the optic-axis</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08Geometric_optics_10_0.png" src="_images/08Geometric_optics_10_0.png" />
</div>
</div>
</div>
<div class="section" id="add-another-lens">
<h3>Add another lens<a class="headerlink" href="#add-another-lens" title="Permalink to this headline">¶</a></h3>
<p>Add a second lens, positioned at <span class="math notranslate nohighlight">\(z=400\)</span> with focal length <span class="math notranslate nohighlight">\(f=100\)</span>, and recalculate the final height and gradient of our original ray at position <span class="math notranslate nohighlight">\(z=450\)</span>.</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ray0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">40</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">])</span>
<span class="n">ray1</span> <span class="o">=</span> <span class="n">dist</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span><span class="nd">@ray0</span>
<span class="n">ray2</span> <span class="o">=</span> <span class="n">lens</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span><span class="nd">@ray1</span>
<span class="n">ray3</span> <span class="o">=</span> <span class="n">dist</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="nd">@ray2</span>
<span class="n">ray4</span> <span class="o">=</span> <span class="n">lens</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="nd">@ray3</span>
<span class="n">ray5</span> <span class="o">=</span> <span class="n">dist</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="nd">@ray4</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ray5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-18.88888889   0.2       ]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="compare-with-combined-matrix">
<h3>Compare with combined matrix<a class="headerlink" href="#compare-with-combined-matrix" title="Permalink to this headline">¶</a></h3>
<p>Verify that you get the same final height and gradient when using a combined ABCD matrix for the whole two-lens system. Make sure that you multiply the ABCD matrices in the correct order and take into account the free-space propagation between elements.</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">system</span> <span class="o">=</span> <span class="n">dist</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="nd">@lens</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="nd">@dist</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="nd">@lens</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span><span class="nd">@dist</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="n">ray0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">40</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">system</span><span class="nd">@ray0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-18.88888889   0.2       ]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="predefined-functions">
<h3>Predefined functions<a class="headerlink" href="#predefined-functions" title="Permalink to this headline">¶</a></h3>
<p>To continue with the case study we will use a few purpose-built functions. These are defined in the cell below.</p>
<p>As inputs, these functions use single rays and single optical elements defined as dictionaries. Multiple rays and multiple optical elements are defined as lists of such dictionaries.</p>
<div class="cell tag_example_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">new_ray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)):</span> <span class="c1"># define a new ray</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">dx</span><span class="p">]),</span> <span class="c1"># height and gradient of ray</span>
        <span class="s2">&quot;z1&quot;</span><span class="p">:</span><span class="n">z</span><span class="p">,</span> <span class="s2">&quot;z2&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>        <span class="c1"># start position and end position of ray (default end is infinity)</span>
        <span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="n">color</span>               <span class="c1"># colour that will be used to plot ray</span>
    <span class="p">}</span>

<span class="k">def</span> <span class="nf">new_opt</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">diam</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span> <span class="c1"># define a new optical element with ABCD matrix, position and aperture size</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;trans&quot;</span><span class="p">:</span><span class="n">trans</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span><span class="n">z</span><span class="p">,</span> <span class="s2">&quot;diam&quot;</span><span class="p">:</span><span class="n">diam</span><span class="p">}</span> 

<span class="k">def</span> <span class="nf">prop_one</span><span class="p">(</span><span class="n">rays</span><span class="p">,</span> <span class="n">opt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Propagate a list of rays through a single optical element, </span>
<span class="sd">    checking first that they actually intercept the optical element.</span>
<span class="sd">    </span>
<span class="sd">    rays (list): a list of rays</span>
<span class="sd">    opt (dictionary): an optical element</span>
<span class="sd">    </span>
<span class="sd">    returns (list): a list of rays</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># extract the details of the optical element</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>
    <span class="n">trans</span> <span class="o">=</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;trans&quot;</span><span class="p">]</span>
    <span class="n">diam</span> <span class="o">=</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;diam&quot;</span><span class="p">]</span>
    
    <span class="c1">#define an empty list in which to store the propagated rays</span>
    <span class="n">out_rays</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># propagate the rays</span>
    <span class="k">for</span> <span class="n">ray</span> <span class="ow">in</span> <span class="n">rays</span><span class="p">:</span>  <span class="c1"># take each ray at a time from the list of rays</span>
        <span class="c1"># make a copy of the ray to prevent changing the input</span>
        <span class="n">in_ray</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># extract the ray&#39;s properties</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">in_ray</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span>
        <span class="n">z1</span> <span class="o">=</span> <span class="n">in_ray</span><span class="p">[</span><span class="s2">&quot;z1&quot;</span><span class="p">]</span>
        <span class="n">z2</span> <span class="o">=</span> <span class="n">in_ray</span><span class="p">[</span><span class="s2">&quot;z2&quot;</span><span class="p">]</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">in_ray</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span>
        <span class="c1"># check the ray is still active and begins before the optical element</span>
        <span class="k">if</span> <span class="n">z2</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="ow">and</span> <span class="n">z1</span> <span class="o">&lt;=</span> <span class="n">z</span><span class="p">:</span>
            <span class="c1"># if the ray reaches the optical element then stop it there</span>
            <span class="n">in_ray</span><span class="p">[</span><span class="s2">&quot;z2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
            
            <span class="c1"># propagate the ray *to* the optical element</span>
            <span class="n">state1</span> <span class="o">=</span> <span class="n">dist</span><span class="p">(</span><span class="n">z</span><span class="o">-</span><span class="n">z1</span><span class="p">)</span><span class="nd">@state</span>
            <span class="c1"># check if the ray gets through the aperture, if it does </span>
            <span class="c1"># then calculate a new ray emitted from the optical emement</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">diam</span><span class="o">/</span><span class="mi">2</span> <span class="p">:</span>
                <span class="c1"># calculate the effect of the optical element</span>
                <span class="n">state2</span> <span class="o">=</span> <span class="n">trans</span><span class="nd">@state1</span>
                <span class="c1"># and create a new ray</span>
                <span class="n">out_ray</span> <span class="o">=</span> <span class="n">new_ray</span><span class="p">(</span><span class="o">*</span><span class="n">state2</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
                <span class="c1"># and put it in our list of rays </span>
                <span class="n">out_rays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_ray</span><span class="p">)</span>
        
        <span class="c1"># always put the incident ray in our list (with modified z2 if appropriate)</span>
        <span class="n">out_rays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">in_ray</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_rays</span>

<span class="k">def</span> <span class="nf">prop_rays</span><span class="p">(</span><span class="n">rays</span><span class="p">,</span> <span class="n">optics</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    propagate a list of rays through a list of optical elements</span>
<span class="sd">    </span>
<span class="sd">    rays (list): a list of rays</span>
<span class="sd">    opts (list): an optical element</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">optics</span><span class="p">:</span> <span class="c1"># take each optical element in turn</span>
        <span class="n">rays</span> <span class="o">=</span> <span class="n">prop_one</span><span class="p">(</span><span class="n">rays</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span> <span class="c1"># propogate all rays through chosen optic</span>
    <span class="k">return</span> <span class="n">rays</span>

<span class="k">def</span> <span class="nf">combined_ABCD</span><span class="p">(</span><span class="n">optics</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the combined transformation ABCD matrix of a list of optical elements</span>
<span class="sd">    </span>
<span class="sd">    optics (list): a list of optical elements</span>
<span class="sd">    </span>
<span class="sd">    returns (np.array): the net transformation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">trans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># start with identity matrix</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">optics</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>     <span class="c1"># prepare distance to next (first) optical element</span>
    
    <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">optics</span><span class="p">:</span>     <span class="c1"># for each element in the optical configuration</span>
        <span class="n">freesp_ABCD</span> <span class="o">=</span> <span class="n">dist</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span><span class="o">-</span><span class="n">z</span><span class="p">)</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;trans&quot;</span><span class="p">]</span><span class="nd">@freesp_ABCD@trans</span> <span class="c1"># include transit to and through optic</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>       <span class="c1"># prepare distance to next optical element </span>
    <span class="k">return</span> <span class="n">trans</span>


<span class="k">def</span> <span class="nf">show_optics</span><span class="p">(</span><span class="n">rays</span><span class="p">,</span> <span class="n">optics</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualise an optical setup and the rays propagated through it.</span>
<span class="sd">    </span>
<span class="sd">    rays (list): a list of rays</span>
<span class="sd">    optics (list): a list of optical elements</span>
<span class="sd">    </span>
<span class="sd">    return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Optical system&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;z (mm)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;x (mm)&quot;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">)</span> <span class="c1"># draw optic-axis</span>
    
    <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">optics</span><span class="p">:</span>  <span class="c1"># for each optic in turn</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>
        <span class="n">diam</span> <span class="o">=</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;diam&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">diam</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>    
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>                                        <span class="c1"># draw an infinite, vertical, black line at position of optic</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">z</span><span class="p">,</span><span class="n">z</span><span class="p">],</span> <span class="p">[</span><span class="n">diam</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">diam</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>     <span class="c1"># draw a white line for the aperture</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">z</span><span class="p">,</span><span class="n">z</span><span class="p">],</span> <span class="p">[</span><span class="n">diam</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">diam</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>   <span class="c1"># make the aperture dotted for visibility</span>
                    
    <span class="n">z_max</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># get maximum x from plot of optical elements</span>
    <span class="n">z_max</span> <span class="o">=</span> <span class="n">z_max</span> <span class="o">+</span> <span class="n">z_max</span><span class="o">/</span><span class="mi">10</span> <span class="c1"># extend 10% beyond max x from plot to distance past last optic</span>
    <span class="k">for</span> <span class="n">ray</span> <span class="ow">in</span> <span class="n">rays</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">ray</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span>
        <span class="n">z1</span> <span class="o">=</span> <span class="n">ray</span><span class="p">[</span><span class="s2">&quot;z1&quot;</span><span class="p">]</span>
        <span class="n">z2</span> <span class="o">=</span> <span class="n">ray</span><span class="p">[</span><span class="s2">&quot;z2&quot;</span><span class="p">]</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">ray</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">z2</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
            <span class="n">z2</span> <span class="o">=</span> <span class="n">z_max</span>
            <span class="n">linestyle</span> <span class="o">=</span> <span class="s2">&quot;--&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">linestyle</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
            
        <span class="n">x1</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">z2</span><span class="o">-</span><span class="n">z1</span><span class="p">)</span> <span class="c1"># use gradient and separation to change height</span>
             
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">z1</span><span class="p">,</span><span class="n">z2</span><span class="p">],</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_example_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># a ray as a dictionary</span>
<span class="nb">print</span><span class="p">(</span><span class="n">new_ray</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">))</span> <span class="c1"># ray with height 2mm, gradient 0.01</span>

<span class="c1"># an optical system as a list of dictionaries - a telescope</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">plane</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">lens1</span> <span class="o">=</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">lens</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">lens2</span> <span class="o">=</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">lens</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">plane</span><span class="p">(),</span> <span class="mi">1200</span><span class="p">)</span>

<span class="n">tele</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="p">,</span> <span class="n">lens1</span><span class="p">,</span> <span class="n">lens2</span><span class="p">,</span> <span class="n">end</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tele</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;state&#39;: array([2.  , 0.01]), &#39;z1&#39;: 0, &#39;z2&#39;: inf, &#39;color&#39;: (1, 0, 0)}
[{&#39;trans&#39;: array([[1., 0.],
       [0., 1.]]), &#39;z&#39;: 0, &#39;diam&#39;: 100}, {&#39;trans&#39;: array([[ 1.   ,  0.   ],
       [-0.005,  1.   ]]), &#39;z&#39;: 200, &#39;diam&#39;: 25}, {&#39;trans&#39;: array([[ 1.    ,  0.    ],
       [-0.0025,  1.    ]]), &#39;z&#39;: 800, &#39;diam&#39;: 25}, {&#39;trans&#39;: array([[1., 0.],
       [0., 1.]]), &#39;z&#39;: 1200, &#39;diam&#39;: 0}]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="create-a-bundle-of-parallel-rays">
<h3>Create a bundle of parallel rays<a class="headerlink" href="#create-a-bundle-of-parallel-rays" title="Permalink to this headline">¶</a></h3>
<p>Create a list of parallel rays named <code class="docutils literal notranslate"><span class="pre">rays</span></code> with <span class="math notranslate nohighlight">\(x\)</span> ranging from <span class="math notranslate nohighlight">\(-5\)</span> to <span class="math notranslate nohighlight">\(5\)</span> in steps of <span class="math notranslate nohighlight">\(1\)</span>, all with gradient <span class="math notranslate nohighlight">\(0.01\)</span>. This list corresponds to a bundle of upward-propagating parallel rays.</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rays</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">rays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_ray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="propagate-rays-through-telescope">
<h3>Propagate rays through telescope<a class="headerlink" href="#propagate-rays-through-telescope" title="Permalink to this headline">¶</a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">prop_rays(rays,tele)</span></code> to calculate the propagation of the bundle of rays defined by the list <code class="docutils literal notranslate"><span class="pre">rays</span></code> through the telescope <code class="docutils literal notranslate"><span class="pre">tele</span></code>. Name the list of rays output from the function <code class="docutils literal notranslate"><span class="pre">p_rays</span></code>.</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_rays</span> <span class="o">=</span> <span class="n">prop_rays</span><span class="p">(</span><span class="n">rays</span><span class="p">,</span> <span class="n">tele</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="draw-propagation-through-telescope">
<h3>Draw propagation through telescope<a class="headerlink" href="#draw-propagation-through-telescope" title="Permalink to this headline">¶</a></h3>
<p>Use the <code class="docutils literal notranslate"><span class="pre">show_optics</span></code> function to display the propagated rays, <code class="docutils literal notranslate"><span class="pre">p_rays</span></code>, as they pass through the telescope.</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_optics</span><span class="p">(</span><span class="n">p_rays</span><span class="p">,</span> <span class="n">tele</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08Geometric_optics_23_0.png" src="_images/08Geometric_optics_23_0.png" />
</div>
</div>
<p><a id="verifyABCD"></a></p>
</div>
<div class="section" id="verify-combined-abcd-matrix">
<h3>Verify combined ABCD matrix<a class="headerlink" href="#verify-combined-abcd-matrix" title="Permalink to this headline">¶</a></h3>
<p>Using matrix multiplication (&#64; in Python), calculate the ABCD matrix for the whole telescope. Check your output against that calculated using the <code class="docutils literal notranslate"><span class="pre">combined_ABCD</span></code> function.</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tele_mat</span> <span class="o">=</span> <span class="n">plane</span><span class="p">()</span><span class="nd">@dist</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span><span class="nd">@lens</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span><span class="nd">@dist</span><span class="p">(</span><span class="mi">600</span><span class="p">)</span><span class="nd">@lens</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span><span class="nd">@dist</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tele_mat</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">combined_ABCD</span><span class="p">(</span><span class="n">tele</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[-2.   0. ]
 [ 0.  -0.5]] 

[[-2.   0. ]
 [ 0.  -0.5]]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="imaging-systems">
<h3>Imaging systems<a class="headerlink" href="#imaging-systems" title="Permalink to this headline">¶</a></h3>
<p>The following code defines a point source with rays emerging at varying gradients.</p>
<div class="cell tag_example_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rays</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">dx</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">):</span>
    <span class="n">rays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_ray</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dx</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-imaging-in-telescope">
<h3>Plot imaging in telescope<a class="headerlink" href="#plot-imaging-in-telescope" title="Permalink to this headline">¶</a></h3>
<p>Display the propagation of the <code class="docutils literal notranslate"><span class="pre">rays</span></code> from the point source through the telescope defined by <code class="docutils literal notranslate"><span class="pre">tele</span></code>. Notice that all the rays are focused by the telescope to a single point. This telescope configuration is called a 4F arrangement, i.e. distance <span class="math notranslate nohighlight">\(f_1\)</span> between the object and the first lens, distance <span class="math notranslate nohighlight">\(f_1 + f_2\)</span> between the two lenses, and distance <span class="math notranslate nohighlight">\(f_2\)</span> between the second lens and the imaging plane.</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_rays</span> <span class="o">=</span> <span class="n">prop_rays</span><span class="p">(</span><span class="n">rays</span><span class="p">,</span> <span class="n">tele</span><span class="p">)</span>
<span class="n">show_optics</span><span class="p">(</span><span class="n">p_rays</span><span class="p">,</span> <span class="n">tele</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08Geometric_optics_29_0.png" src="_images/08Geometric_optics_29_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="study">
<h2>Study<a class="headerlink" href="#study" title="Permalink to this headline">¶</a></h2>
<p>We want to study the properties of an optical system as a function of its constituent parts. We will look at imaging in an eye, discuss magnification factor, and study rays in periodic focusing systems.</p>
<div class="section" id="model-imaging-of-an-eye">
<h3>Model imaging of an eye<a class="headerlink" href="#model-imaging-of-an-eye" title="Permalink to this headline">¶</a></h3>
<p>Model an eye as a lens, positioned at <span class="math notranslate nohighlight">\(z=400\)</span> with a focal length of <span class="math notranslate nohighlight">\(17\)</span>, and a retina (imaging plane) at a distance of 17 behind the lens (positioned at <span class="math notranslate nohighlight">\(z=417\)</span>). Use <span class="math notranslate nohighlight">\(10\)</span> as the iris diameter of the eye. Use the <code class="docutils literal notranslate"><span class="pre">show_optics</span></code> function to model the eye looking at a point-source object at <span class="math notranslate nohighlight">\(z=0\)</span> and <span class="math notranslate nohighlight">\(x=10\)</span> (set the aperture diameter as 100) with a ray bundle of gradient varying from <span class="math notranslate nohighlight">\(-0.05\)</span> to <span class="math notranslate nohighlight">\(0.00\)</span> in steps of <span class="math notranslate nohighlight">\(0.002\)</span>. Is the object in focus? You may wish to zoom in to examine the focal point more closely; use the “Zoom to rectangle” option (little square control) on the plot to zoom (assuming you are using <code class="docutils literal notranslate"><span class="pre">%matplotlib</span> <span class="pre">widget</span></code>).</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">obj</span> <span class="o">=</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">plane</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">lens0</span> <span class="o">=</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">lens</span><span class="p">(</span><span class="mi">17</span><span class="p">),</span> <span class="mi">400</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">retina</span> <span class="o">=</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">plane</span><span class="p">(),</span> <span class="mi">417</span><span class="p">)</span>
<span class="n">eye</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="p">,</span> <span class="n">lens0</span><span class="p">,</span> <span class="n">retina</span><span class="p">]</span>

<span class="n">rays</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">dx</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">):</span>
    <span class="n">rays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_ray</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">dx</span><span class="p">))</span>
    
<span class="n">p_rays</span> <span class="o">=</span> <span class="n">prop_rays</span><span class="p">(</span><span class="n">rays</span><span class="p">,</span> <span class="n">eye</span><span class="p">)</span>
<span class="n">show_optics</span><span class="p">(</span><span class="n">p_rays</span><span class="p">,</span> <span class="n">eye</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08Geometric_optics_32_0.png" src="_images/08Geometric_optics_32_0.png" />
</div>
</div>
</div>
<div class="section" id="quantifying-focus">
<h3>Quantifying focus<a class="headerlink" href="#quantifying-focus" title="Permalink to this headline">¶</a></h3>
<p>Define a function called <code class="docutils literal notranslate"><span class="pre">focus_variance</span></code> that takes the focal length of the eye’s lens, and the object-to-eye distance as arguments. The function should return the variance of the distribution of the rays striking the retina. Plot the focus variance as a function of eye focal-length for three different object distances or <span class="math notranslate nohighlight">\(400\)</span>, <span class="math notranslate nohighlight">\(1000\)</span> and <span class="math notranslate nohighlight">\(2000\)</span>.</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">focus_variance</span><span class="p">(</span><span class="n">eye_focal_length</span><span class="p">,</span> <span class="n">obj_distance</span><span class="p">):</span>
    <span class="n">lens_z</span> <span class="o">=</span> <span class="n">obj_distance</span>
    <span class="n">retina_z</span> <span class="o">=</span> <span class="n">obj_distance</span> <span class="o">+</span> <span class="mi">17</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">plane</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">lens0</span> <span class="o">=</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">lens</span><span class="p">(</span><span class="n">eye_focal_length</span><span class="p">),</span> <span class="n">lens_z</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">retina</span> <span class="o">=</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">plane</span><span class="p">(),</span> <span class="n">retina_z</span><span class="p">)</span>
    <span class="n">eye</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="p">,</span> <span class="n">lens0</span><span class="p">,</span> <span class="n">retina</span><span class="p">]</span>
    
    <span class="c1">#define a dense bundle of rays to make a more statistically significant variance</span>
    <span class="n">rays</span> <span class="o">=</span> <span class="p">[]</span> 
    <span class="k">for</span> <span class="n">dx</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.0005</span><span class="p">):</span> 
        <span class="n">rays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_ray</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">dx</span><span class="p">))</span>

    <span class="n">p_rays</span> <span class="o">=</span> <span class="n">prop_rays</span><span class="p">(</span><span class="n">rays</span><span class="p">,</span> <span class="n">eye</span><span class="p">)</span>
    
    <span class="c1"># extract the positions of rays strinking the retina</span>
    <span class="n">retina_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">ray</span> <span class="ow">in</span> <span class="n">p_rays</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ray</span><span class="p">[</span><span class="s2">&quot;z2&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">retina_z</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">ray</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span>
            <span class="n">retina_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">retina_x</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="s2">&quot;z2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ray</span><span class="p">[</span><span class="s2">&quot;z1&quot;</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">retina_x</span><span class="p">)</span>

<span class="n">focal_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span> <span class="c1"># the granularity determines precision of plot and looked-up minimum. </span>
<span class="n">focus_variance_400</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="n">focus_variance_1000</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="n">focus_variance_2000</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="k">for</span> <span class="n">foclen</span> <span class="ow">in</span> <span class="n">focal_length</span><span class="p">:</span>
    <span class="n">focus_variance_400</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">focus_variance_400</span><span class="p">,</span><span class="n">focus_variance</span><span class="p">(</span><span class="n">foclen</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
    <span class="n">focus_variance_1000</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">focus_variance_1000</span><span class="p">,</span><span class="n">focus_variance</span><span class="p">(</span><span class="n">foclen</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
    <span class="n">focus_variance_2000</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">focus_variance_2000</span><span class="p">,</span><span class="n">focus_variance</span><span class="p">(</span><span class="n">foclen</span><span class="p">,</span> <span class="mi">2000</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Focus variance&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Eye focal length (mm)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Variance&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">focal_length</span><span class="p">,</span> <span class="n">focus_variance_400</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">400</span><span class="si">}</span><span class="s2"> mm&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">focal_length</span><span class="p">,</span> <span class="n">focus_variance_1000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">1000</span><span class="si">}</span><span class="s2"> mm&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">focal_length</span><span class="p">,</span> <span class="n">focus_variance_2000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">2000</span><span class="si">}</span><span class="s2"> mm&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08Geometric_optics_34_0.png" src="_images/08Geometric_optics_34_0.png" />
</div>
</div>
</div>
<div class="section" id="find-best-focus">
<h3>Find best focus<a class="headerlink" href="#find-best-focus" title="Permalink to this headline">¶</a></h3>
<p>Find the minimum variance for each of the three object positions (<span class="math notranslate nohighlight">\(400\)</span>, <span class="math notranslate nohighlight">\(1000\)</span> and <span class="math notranslate nohighlight">\(2000\)</span>) and determine the eye focal length producing these best focii. Use the <code class="docutils literal notranslate"><span class="pre">show_optics</span></code> function to show the propagation of a point-source object at <span class="math notranslate nohighlight">\(z=0\)</span> and <span class="math notranslate nohighlight">\(x=10\)</span> (set aperture diameter as 100) with a ray bundle of gradient varying from <span class="math notranslate nohighlight">\(-0.05\)</span> to <span class="math notranslate nohighlight">\(0.00\)</span> in steps of <span class="math notranslate nohighlight">\(0.001\)</span>.</p>
<div class="cell tag_example_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">focal_length_400</span> <span class="o">=</span>  <span class="n">minimize</span><span class="p">(</span><span class="n">focus_variance</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1E-10</span><span class="p">)</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">focal_length_1000</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">focus_variance</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1E-10</span><span class="p">)</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">focal_length_2000</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">focus_variance</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">2000</span><span class="p">),</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1E-10</span><span class="p">)</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  400 mm focal length: </span><span class="si">{</span><span class="n">focal_length_400</span><span class="si">:</span><span class="s2">0.4f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>\
      <span class="sa">f</span><span class="s2">&quot;1000 mm focal length: </span><span class="si">{</span><span class="n">focal_length_1000</span><span class="si">:</span><span class="s2">0.4f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> \
      <span class="sa">f</span><span class="s2">&quot;2000 mm focal length: </span><span class="si">{</span><span class="n">focal_length_2000</span><span class="si">:</span><span class="s2">0.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1">#printed with 4 decimal places</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  400 mm focal length: 16.3070
 1000 mm focal length: 16.7158
 2000 mm focal length: 16.8567
</pre></div>
</div>
</div>
</div>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rays</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">dx</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">):</span>
    <span class="n">rays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_ray</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">dx</span><span class="p">))</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">plane</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">lens_400</span> <span class="o">=</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">lens</span><span class="p">(</span><span class="n">focal_length_400</span><span class="p">),</span> <span class="mi">400</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">retina_400</span> <span class="o">=</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">plane</span><span class="p">(),</span> <span class="mi">417</span><span class="p">)</span>
<span class="n">eye_400</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="p">,</span> <span class="n">lens_400</span><span class="p">,</span> <span class="n">retina_400</span><span class="p">]</span>
<span class="n">p_rays_400</span> <span class="o">=</span> <span class="n">prop_rays</span><span class="p">(</span><span class="n">rays</span><span class="p">,</span> <span class="n">eye_400</span><span class="p">)</span>
<span class="n">show_optics</span><span class="p">(</span><span class="n">p_rays_400</span><span class="p">,</span> <span class="n">eye_400</span><span class="p">)</span>

<span class="n">lens_1000</span> <span class="o">=</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">lens</span><span class="p">(</span><span class="n">focal_length_1000</span><span class="p">),</span> <span class="mi">1000</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">retina_1000</span> <span class="o">=</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">plane</span><span class="p">(),</span> <span class="mi">1017</span><span class="p">)</span>
<span class="n">eye_1000</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="p">,</span> <span class="n">lens_1000</span><span class="p">,</span> <span class="n">retina_1000</span><span class="p">]</span>
<span class="n">p_rays_1000</span> <span class="o">=</span> <span class="n">prop_rays</span><span class="p">(</span><span class="n">rays</span><span class="p">,</span> <span class="n">eye_1000</span><span class="p">)</span>
<span class="n">show_optics</span><span class="p">(</span><span class="n">p_rays_1000</span><span class="p">,</span> <span class="n">eye_1000</span><span class="p">)</span>

<span class="n">lens_2000</span> <span class="o">=</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">lens</span><span class="p">(</span><span class="n">focal_length_2000</span><span class="p">),</span> <span class="mi">2000</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">retina_2000</span> <span class="o">=</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">plane</span><span class="p">(),</span> <span class="mi">2017</span><span class="p">)</span>
<span class="n">eye_2000</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="p">,</span> <span class="n">lens_2000</span><span class="p">,</span> <span class="n">retina_2000</span><span class="p">]</span>
<span class="n">p_rays_2000</span> <span class="o">=</span> <span class="n">prop_rays</span><span class="p">(</span><span class="n">rays</span><span class="p">,</span> <span class="n">eye_2000</span><span class="p">)</span>
<span class="n">show_optics</span><span class="p">(</span><span class="n">p_rays_2000</span><span class="p">,</span> <span class="n">eye_2000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08Geometric_optics_37_0.png" src="_images/08Geometric_optics_37_0.png" />
<img alt="_images/08Geometric_optics_37_1.png" src="_images/08Geometric_optics_37_1.png" />
<img alt="_images/08Geometric_optics_37_2.png" src="_images/08Geometric_optics_37_2.png" />
</div>
</div>
</div>
<div class="section" id="combined-abcd-matrix-of-imaging-systems">
<h3>Combined ABCD matrix of imaging systems<a class="headerlink" href="#combined-abcd-matrix-of-imaging-systems" title="Permalink to this headline">¶</a></h3>
<p>Calculate the overall ABCD matrices for each of the object positions (<span class="math notranslate nohighlight">\(400\)</span>, <span class="math notranslate nohighlight">\(1000\)</span> and <span class="math notranslate nohighlight">\(2000\)</span>) when in best focus (minimum variance). You should have three ABCD matrices with <span class="math notranslate nohighlight">\(B \approx 0\)</span>. Indeed, any optical system where <span class="math notranslate nohighlight">\(B=0\)</span> will be an imaging system.</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ABCD_400</span> <span class="o">=</span> <span class="n">combined_ABCD</span><span class="p">(</span><span class="n">eye_400</span><span class="p">)</span>
<span class="n">ABCD_1000</span> <span class="o">=</span> <span class="n">combined_ABCD</span><span class="p">(</span><span class="n">eye_1000</span><span class="p">)</span>
<span class="n">ABCD_2000</span> <span class="o">=</span> <span class="n">combined_ABCD</span><span class="p">(</span><span class="n">eye_2000</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">floatmode</span><span class="o">=</span><span class="s1">&#39;maxprec_equal&#39;</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#print with set precision and suppress small values</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ABCD_400</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ABCD_1000</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ABCD_2000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[ -0.043  -0.000]
 [ -0.061 -23.529]] 

[[ -0.017  -0.000]
 [ -0.060 -58.824]] 

[[  -0.009   -0.000]
 [  -0.059 -117.647]]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="magnification-factor">
<h3>Magnification factor<a class="headerlink" href="#magnification-factor" title="Permalink to this headline">¶</a></h3>
<p>Taking any one of these ABCD matrices, determine the relationship between the height of the object and the image size on the retina. What is the magnification factor in relationship to the ABCD matrix?</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">state0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">state400</span> <span class="o">=</span> <span class="n">ABCD_400</span><span class="nd">@state0</span>
<span class="n">state1000</span> <span class="o">=</span> <span class="n">ABCD_1000</span><span class="nd">@state0</span>
<span class="n">state2000</span> <span class="o">=</span> <span class="n">ABCD_2000</span><span class="nd">@state0</span>

<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">floatmode</span><span class="o">=</span><span class="s1">&#39;maxprec_equal&#39;</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># optional print with set precision and suppress small values</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ABCD matrix: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">ABCD_400</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Magnification: </span><span class="si">{</span><span class="n">state400</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># magnification factor</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ABCD matrix: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">ABCD_1000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Magnification: </span><span class="si">{</span><span class="n">state1000</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># magnification factor</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ABCD matrix: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">ABCD_2000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Magnification: </span><span class="si">{</span><span class="n">state2000</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># magnification factor</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ABCD matrix: 
 [[ -0.043  -0.000]
 [ -0.061 -23.529]]
Magnification: -0.043 

ABCD matrix: 
 [[ -0.017  -0.000]
 [ -0.060 -58.824]]
Magnification: -0.017 

ABCD matrix: 
 [[  -0.009   -0.000]
 [  -0.059 -117.647]]
Magnification: -0.009
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="f-system-lateral-magnification">
<h3>4F system lateral magnification<a class="headerlink" href="#f-system-lateral-magnification" title="Permalink to this headline">¶</a></h3>
<p>Calculate the magnification for a <span class="math notranslate nohighlight">\(4F\)</span> optical imaging telescope defined by two lenses with focal length <span class="math notranslate nohighlight">\(f_1\)</span> and <span class="math notranslate nohighlight">\(f_2\)</span> and check against that <a class="reference external" href="#verifyABCD">calculated earlier</a>.</p>
<p>Verify that the magnitude of this magnification factor is equal to <span class="math notranslate nohighlight">\(f_2/f_1\)</span>. Can you explain what the sign being negative means?</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tele_mat</span> <span class="o">=</span> <span class="n">plane</span><span class="p">()</span><span class="nd">@dist</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span><span class="nd">@lens</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span><span class="nd">@dist</span><span class="p">(</span><span class="mi">600</span><span class="p">)</span><span class="nd">@lens</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span><span class="nd">@dist</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ABCD matrix: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">tele_mat</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Magnification: &quot;</span><span class="p">,</span><span class="n">tele_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># magnification factor</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The image in a 4F telescope is inverted, hence the negative sign.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ABCD matrix: 
 [[-2.0  0.0]
 [ 0.0 -0.5]] 

Magnification:  -2.0
The image in a 4F telescope is inverted, hence the negative sign.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="periodic-optical-system">
<h3>Periodic optical system<a class="headerlink" href="#periodic-optical-system" title="Permalink to this headline">¶</a></h3>
<p>Consider a periodically repeating optical system where each period consists of a thin lens of focal length <span class="math notranslate nohighlight">\(f\)</span> and a distance <span class="math notranslate nohighlight">\(d\)</span> of free-space propagation. Display the height of a ray starting with <span class="math notranslate nohighlight">\((x_1 , x_1' ) = (1, 0)\)</span> as it propagates through the first <span class="math notranslate nohighlight">\(100\)</span> periods as a function of the period number. Do this for <span class="math notranslate nohighlight">\(f = 10\)</span>; <span class="math notranslate nohighlight">\(d = 1\)</span> and for <span class="math notranslate nohighlight">\(f = 1\)</span>; <span class="math notranslate nohighlight">\(d = 10\)</span>. Comment on what you observe, and why this is the case.</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">periodic_system</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    models the propagation of a ray trough a periodic system of lenses</span>
<span class="sd">    </span>
<span class="sd">    f (float): focal length of lenses</span>
<span class="sd">    d (float): lens seperation</span>
<span class="sd">    </span>
<span class="sd">    returns: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optics</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">optics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_opt</span><span class="p">(</span><span class="n">lens</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">d</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

    <span class="n">rays</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_ray</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span>

    <span class="n">p_rays</span> <span class="o">=</span> <span class="n">prop_rays</span><span class="p">(</span><span class="n">rays</span><span class="p">,</span> <span class="n">optics</span><span class="p">)</span>
    <span class="n">show_optics</span><span class="p">(</span><span class="n">p_rays</span><span class="p">,</span> <span class="n">optics</span><span class="p">)</span>
    
<span class="n">periodic_system</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">periodic_system</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08Geometric_optics_45_0.png" src="_images/08Geometric_optics_45_0.png" />
<img alt="_images/08Geometric_optics_45_1.png" src="_images/08Geometric_optics_45_1.png" />
</div>
</div>
</div>
<div class="section" id="abcd-eigenvalue">
<h3>ABCD eigenvalue<a class="headerlink" href="#abcd-eigenvalue" title="Permalink to this headline">¶</a></h3>
<p>Determine the eigenvalue of the single-period ABCD matrix and compare the absolute value of these in the two cases. What is the physical meaning of the eigenvalue with respect to the <span class="math notranslate nohighlight">\(x\)</span>-distance of the ray propagating through the system?</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optics_10_1</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_opt</span><span class="p">(</span><span class="n">plane</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">lens</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">25</span><span class="p">)]</span>
<span class="n">ABCD_10_1</span> <span class="o">=</span> <span class="n">combined_ABCD</span><span class="p">(</span><span class="n">optics_10_1</span><span class="p">)</span>
<span class="n">eigs_10_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eig</span><span class="p">(</span><span class="n">ABCD_10_1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optics_1_10</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_opt</span><span class="p">(</span><span class="n">plane</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">new_opt</span><span class="p">(</span><span class="n">lens</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">)]</span>
<span class="n">ABCD_1_10</span> <span class="o">=</span> <span class="n">combined_ABCD</span><span class="p">(</span><span class="n">optics_1_10</span><span class="p">)</span>
<span class="n">eigs_1_10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eig</span><span class="p">(</span><span class="n">ABCD_1_10</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Eigenvalues for f=10, d=1: </span><span class="si">{</span><span class="n">eigs_10_1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Eigenvalues for f=1, d=10: </span><span class="si">{</span><span class="n">eigs_1_10</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">The eigenvalue is a multiplication coefficient of a ray-state eigenvector. Eigenvalues </span>
<span class="s1">larger than one correspond to rays which move away from the optic-axis, while eigenvalues </span>
<span class="s1">smaller than one correspond to rays which move towards the optic-axis. When propagated</span>
<span class="s1">through multiple periods then this corresponds to divergent or convergent rays, respectively.</span>
<span class="s1">Eigenvalues with an absolute value equal to one give stable rays through the system.</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Eigenvalues for f=10, d=1: [1. 1.]
Eigenvalues for f=1, d=10: [0.127 7.873]

The eigenvalue is a multiplication coefficient of a ray-state eigenvector. Eigenvalues 
larger than one correspond to rays which move away from the optic-axis, while eigenvalues 
smaller than one correspond to rays which move towards the optic-axis. When propagated
through multiple periods then this corresponds to divergent or convergent rays, respectively.
Eigenvalues with an absolute value equal to one give stable rays through the system.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="stability-region-plot">
<h3>Stability region plot<a class="headerlink" href="#stability-region-plot" title="Permalink to this headline">¶</a></h3>
<p>Use the matplotlib <code class="docutils literal notranslate"><span class="pre">contourf</span></code> function to display the region of stability for our periodically repeating optical system with <span class="math notranslate nohighlight">\(d\)</span> varying between <span class="math notranslate nohighlight">\(0\)</span> and <span class="math notranslate nohighlight">\(10\)</span> and <span class="math notranslate nohighlight">\(f\)</span> between <span class="math notranslate nohighlight">\(-10\)</span> and <span class="math notranslate nohighlight">\(10\)</span>. This is called a “lens equivalent waveguide”.</p>
<p>Expect this to take approx <span class="math notranslate nohighlight">\(10-15s\)</span> to compute.</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="n">f_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">d_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">stable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">f_range</span><span class="p">,</span> <span class="n">d_range</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">calculate_stability</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">ABCD</span> <span class="o">=</span> <span class="n">lens</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="nd">@dist</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">eigs</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eig</span><span class="p">(</span><span class="n">ABCD</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">eigs</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1.01</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="mi">0</span>

<span class="n">stability</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">stability</span><span class="p">[</span><span class="n">i0</span><span class="p">,</span><span class="n">i1</span><span class="p">]</span><span class="o">=</span><span class="n">calculate_stability</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i0</span><span class="p">,</span><span class="n">i1</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">i0</span><span class="p">,</span><span class="n">i1</span><span class="p">])</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Region of stability&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Focal length (mm)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Lens separation (mm)&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">stability</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">])</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 6.76 s, sys: 157 ms, total: 6.92 s
Wall time: 6.7 s
</pre></div>
</div>
<img alt="_images/08Geometric_optics_50_1.png" src="_images/08Geometric_optics_50_1.png" />
</div>
</div>
</div>
<div class="section" id="laser-cavity-stability">
<h3>Laser cavity stability<a class="headerlink" href="#laser-cavity-stability" title="Permalink to this headline">¶</a></h3>
<p>Consider an optical cavity consisting of two spherical curved mirrors with radii <span class="math notranslate nohighlight">\(R_1\)</span> and <span class="math notranslate nohighlight">\(R_2\)</span> separated by the distance <span class="math notranslate nohighlight">\(L\)</span>. A round trip in the cavity corresponds to one period. Considering one full period of the cavity, plot the region of stability for <span class="math notranslate nohighlight">\(L = 1\)</span> in the parameter space <span class="math notranslate nohighlight">\(R_1\)</span> and <span class="math notranslate nohighlight">\(R_2\)</span> varying each between <span class="math notranslate nohighlight">\(-4\)</span> and <span class="math notranslate nohighlight">\(4\)</span>.</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">r_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">L</span><span class="o">=</span> <span class="mi">1</span>

<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">r_range</span><span class="p">,</span> <span class="n">r_range</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">calculate_stability</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">):</span>
    <span class="n">ABCD</span> <span class="o">=</span> <span class="n">mirror</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span><span class="nd">@dist</span><span class="p">(</span><span class="n">L</span><span class="p">)</span><span class="nd">@mirror</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span><span class="nd">@dist</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    <span class="n">eigs</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eig</span><span class="p">(</span><span class="n">ABCD</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">eigs</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1.01</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="mi">0</span>

<span class="n">stability</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">stability</span><span class="p">[</span><span class="n">i0</span><span class="p">,</span><span class="n">i1</span><span class="p">]</span><span class="o">=</span><span class="n">calculate_stability</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i0</span><span class="p">,</span><span class="n">i1</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">i0</span><span class="p">,</span><span class="n">i1</span><span class="p">])</span>
        
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Region of stability&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$R_1$ (mm)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$R_2$ (mm)&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">stability</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">])</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 2.69 s, sys: 228 ms, total: 2.92 s
Wall time: 2.59 s
</pre></div>
</div>
<img alt="_images/08Geometric_optics_52_1.png" src="_images/08Geometric_optics_52_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="advanced-problem">
<h2>Advanced problem<a class="headerlink" href="#advanced-problem" title="Permalink to this headline">¶</a></h2>
<p>The stability region is usually represented as a function of parameters <span class="math notranslate nohighlight">\(g_1\)</span> and <span class="math notranslate nohighlight">\(g_2\)</span>, where <span class="math notranslate nohighlight">\(g_1 = 1 − L/R_1\)</span> and <span class="math notranslate nohighlight">\(g_2 = 1 − L/R_2\)</span>. Considering the case where <span class="math notranslate nohighlight">\(L = 1\)</span>, write <span class="math notranslate nohighlight">\(R_1\)</span> and <span class="math notranslate nohighlight">\(R_2\)</span> as a function of <span class="math notranslate nohighlight">\(g_1\)</span> and <span class="math notranslate nohighlight">\(g_2\)</span>, and re-plot the region of stability with <span class="math notranslate nohighlight">\(g_1\)</span> and <span class="math notranslate nohighlight">\(g_2\)</span> varying between <span class="math notranslate nohighlight">\(-4\)</span> and <span class="math notranslate nohighlight">\(4\)</span>. Check your graph against <a class="reference external" href="https://en.wikipedia.org/wiki/Optical_cavity#Stability">https://en.wikipedia.org/wiki/Optical_cavity#Stability</a>.</p>
<div class="cell tag_solution_code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="n">g_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.05</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>
<span class="n">n_g</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_range</span><span class="p">)</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">stable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">g_range</span><span class="p">,</span> <span class="n">g_range</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">calculate_stability</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">):</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">g1</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">g2</span><span class="p">)</span>
    <span class="n">ABCD</span> <span class="o">=</span> <span class="n">mirror</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span><span class="nd">@dist</span><span class="p">(</span><span class="n">L</span><span class="p">)</span><span class="nd">@mirror</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span><span class="nd">@dist</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    <span class="n">eigs</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eig</span><span class="p">(</span><span class="n">ABCD</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">eigs</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1.01</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="mi">0</span>

<span class="n">stability</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">stability</span><span class="p">[</span><span class="n">i0</span><span class="p">,</span><span class="n">i1</span><span class="p">]</span><span class="o">=</span><span class="n">calculate_stability</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i0</span><span class="p">,</span><span class="n">i1</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">i0</span><span class="p">,</span><span class="n">i1</span><span class="p">])</span>
        
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Region of stability&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$g_1$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$g_2$&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">stability</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">])</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 14.3 s, sys: 473 ms, total: 14.8 s
Wall time: 14.2 s
</pre></div>
</div>
<img alt="_images/08Geometric_optics_54_1.png" src="_images/08Geometric_optics_54_1.png" />
</div>
</div>
</div>
<div class="section" id="function-glossary">
<h2>Function glossary<a class="headerlink" href="#function-glossary" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>scipy.minimize</p></li>
<li><p>plt.contourf</p></li>
<li><p>np.meshgrid</p></li>
<li><p>dictionaries</p></li>
</ul>
</div>
</div>

<script type="text/x-thebe-config">
{
  requestKernel: true,
  kernelOptions: {
    name: "python3",
 serverSettings: {
        "baseUrl": "https://teachinghub.st-andrews.ac.uk/thub",
        "token": "c6d9a669228c440b9720c08818b8b37c"
      }
  },
}
</script>
<!-- The kernel needs specifiying too -->
 <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="notebooks.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Content with notebooks</p>
        </div>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Jupyter Book Community<br/>
  
      &copy; Copyright 2020.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>
